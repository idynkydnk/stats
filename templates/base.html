<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %} {% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="viewport" content="width=device-width" />
</head>
<body>
    {% if session.logged_in %}
    <nav>
        <div class="dropdown">
            <button class="dropbtn">Add/Edit
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="{{ url_for('add_game') }}">Doubles</a>
                <a href="{{ url_for('add_vollis_game') }}">Vollis</a>
                <a href="{{ url_for('add_other_game') }}">Other</a>
                <a href="{{ url_for('player_list') }}">Players</a>
            </div>
        </div>  
    </nav>
    {% endif %}
    
    <nav>
        <div class="menu-container">
            <button class="menu-toggle" id="menu-toggle">☰</button>
            <div class="menu-overlay" id="menu-overlay"></div>
            <div class="menu-sidebar" id="menu-sidebar">
                <button class="menu-close" id="menu-close">×</button>
                <ul class="menu-list">
                    <li><a href="{{ url_for('index') }}"><i class="fas fa-chart-bar"></i> Doubles Stats</a></li>
                    <li><a href="{{ url_for('vollis_stats_default') }}"><i class="fas fa-chart-line"></i> Vollis Stats</a></li>
                    <li><a href="{{ url_for('other_stats_default') }}"><i class="fas fa-chart-pie"></i> Other Stats</a></li>
                    {% if session.logged_in %}
                        <li><a href="{{ url_for('edit_stats') }}"><i class="fas fa-edit"></i> Edit Stats</a></li>
                        {% if session.username and session.username|lower == 'kyle' %}
                            <li><a href="{{ url_for('notifications') }}"><i class="fas fa-bell"></i> Notifications</a></li>
                            <li><a href="{{ url_for('benchmarks') }}"><i class="fas fa-tachometer-alt"></i> Benchmarks</a></li>
                        {% endif %}
                        <li><a href="{{ url_for('manage_player_names') }}"><i class="fas fa-edit"></i> Manage Player Names</a></li>
                        <li><a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout ({{ session.username }})</a></li>
                    {% else %}
                        <li><a href="{{ url_for('login') }}"><i class="fas fa-sign-in-alt"></i> Login</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    <div class="content">
        {% for message in get_flashed_messages() %}
            <div class="alert">{{ message }}</div>
        {% endfor %}
        {% block content %} {% endblock %}
    </div>

    <script>
        // Simple hamburger menu functionality
        const menuToggle = document.getElementById('menu-toggle');
        const menuClose = document.getElementById('menu-close');
        const menuOverlay = document.getElementById('menu-overlay');
        const menuSidebar = document.getElementById('menu-sidebar');

        function openMenu() {
            menuOverlay.classList.add('active');
            menuSidebar.classList.add('active');
            menuToggle.classList.add('active');
            menuToggle.textContent = '×';
        }

        function closeMenu() {
            menuOverlay.classList.remove('active');
            menuSidebar.classList.remove('active');
            menuToggle.classList.remove('active');
            menuToggle.textContent = '☰';
        }

        // Toggle menu when clicking hamburger button (opens if closed, closes if open)
        menuToggle.addEventListener('click', function() {
            if (menuToggle.classList.contains('active')) {
                closeMenu();
            } else {
                openMenu();
            }
        });

        // Close menu when clicking X button inside sidebar
        menuClose.addEventListener('click', closeMenu);

        // Close menu when clicking overlay (outside the sidebar)
        menuOverlay.addEventListener('click', closeMenu);

        // Close menu when clicking on menu links
        document.querySelectorAll('.menu-list a').forEach(link => {
            link.addEventListener('click', closeMenu);
        });

        // Detect and send user's timezone to server
        document.addEventListener('DOMContentLoaded', function() {
            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if (userTimezone) {
                fetch('/api/set_timezone', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({timezone: userTimezone})
                }).catch(err => console.log('Could not set timezone:', err));
            }
        });

    </script>
</body>
</html>
