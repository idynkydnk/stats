{% extends 'base.html' %}

{% block content %}
<style>
.page-header {
    margin-bottom: 20px;
}

.page-header h1 {
    margin-bottom: 8px;
}

.games-count {
    font-size: 14px;
    color: var(--caption);
    margin-bottom: 16px;
}

.games-grid {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.game-card {
    background: var(--table-bg);
    border-radius: 8px;
    padding: 10px 12px;
    border: 1px solid var(--table-banding);
    transition: all 0.2s ease;
}

.game-card:hover {
    border-color: var(--button-border-1);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    gap: 8px;
}

.card-title {
    flex: 1;
    display: flex;
    align-items: baseline;
    gap: 8px;
    flex-wrap: wrap;
}

.game-name {
    font-size: 15px;
    font-weight: 600;
    color: var(--text);
    margin: 0;
}

.game-name a {
    color: var(--text);
    text-decoration: none;
}

.game-name a:hover {
    color: #aeee98;
}

.game-type {
    font-size: 11px;
    color: var(--caption);
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.game-date {
    font-size: 12px;
    color: var(--caption);
    text-align: right;
    white-space: nowrap;
}

.card-body {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
}

.team-section {
    padding: 6px 10px;
    border-radius: 6px;
    background: rgba(0, 0, 0, 0.15);
}

.team-section.winners {
    border-left: 2px solid #aeee98;
}

.team-section.losers {
    border-left: 2px solid #ff6b6b;
}

.team-label {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    color: var(--caption);
    margin-bottom: 4px;
}

.team-label.winners {
    color: #aeee98;
}

.team-label.losers {
    color: #ff6b6b;
}

.team-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.players-list {
    flex: 1;
}

.team-score-center {
    /* Same positioning as player-score in player-item */
}

.player-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1px 0;
}

.player-item a {
    color: var(--text);
    text-decoration: none;
    font-size: 13px;
}

.player-item a:hover {
    color: #aeee98;
}

.player-score {
    font-weight: 600;
    color: #aeee98;
    font-size: 12px;
}

/* All loser scores should be red */
.team-section.losers .player-score {
    color: #ff6b6b;
}

.empty-state {
    text-align: center;
    padding: 40px 20px;
    color: var(--caption);
}

.empty-state h2 {
    font-size: 20px;
    margin-bottom: 6px;
    color: var(--text);
}

/* Stats table styles */
.stats-section {
    margin-bottom: 24px;
}

.stats-section h3 {
    margin-bottom: 12px;
}

.stats-hidden { display: none; }

.expand-btn-container { 
    text-align: center; 
    margin: 10px 0 20px 0; 
}

.expand-btn {
    background-color: var(--button-border-1);
    color: var(--button-bg-1);
    border: 2px solid var(--button-bg-1);
    border-radius: 12px;
    padding: 8px 16px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.expand-btn:hover {
    background-color: var(--button-bg-1);
    color: var(--button-text-1);
}

.expand-btn i { 
    margin-left: 5px; 
    transition: transform 0.2s ease; 
}

.expand-btn.expanded i { 
    transform: rotate(180deg); 
}

@media (max-width: 600px) {
    .card-body {
        grid-template-columns: 1fr;
        gap: 8px;
    }
}
</style>

<nav>
    <div class="dropdown">
        <button class="dropbtn">Select a year
            <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content">
            {% for yr in all_years %}
                <a href="{{ url_for('other_games_by_year', year=yr) }}">{{ yr }}</a>
            {% endfor %}
        </div>
    </div>       
</nav>

<div class="page-header">
    <h1>{% block title %}{{ year }} {% if game_name %}{{ game_name }}{% else %}Other{% endif %} Games{% endblock %}</h1>
    <p class="page-sublink"><a href="{{ url_for('other_stats', year=year) }}"><i class="fas fa-arrow-left"></i> Back to {{ year }} other stats</a></p>
</div>

{% if stats and game_name %}
<div class="stats-section">
    <h3>{{ game_name }} Stats</h3>
    <div>
        <table>
            <thead>
                <tr>
                    <th class="rank" scope="col" colspan="1">#</th>
                    <th class="player_name" scope="col" colspan="1">Player</th>
                    <th class="numbered_stats" scope="col" colspan="1">Wins</th>
                    <th class="numbered_stats" scope="col" colspan="1">Losses</th>
                    <th class="numbered_stats" scope="col" colspan="1">Win %</th>
                    <th class="numbered_stats" scope="col" colspan="1">Games</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in stats %}
                <tr class="{% if loop.index > 8 %}stats-hidden{% endif %}">
                    <td class="rank">{{ loop.index }}</td>
                    <td class="player_name"><a href="{{ url_for('other_player_stats', year=year, name=stat[0]) }}">{{ stat[0] }}</a></td>
                    <td>{{ stat[1] }}</td>
                    <td>{{ stat[2] }}</td>
                    <td>{{ "{:.2f}".format(stat[3]*100) }}</td>
                    <td>{{ stat[1] + stat[2] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% if stats|length > 8 %}
    <div class="expand-btn-container">
        <button id="expand-stats" class="expand-btn" onclick="toggleStats()">
            Show {{ stats|length - 8 }} more <i class="fa fa-chevron-down"></i>
        </button>
    </div>
    {% endif %}
</div>
{% endif %}

<div class="games-count">All Games ({{ games|length }})</div>

<div class="games-grid">
    {% if games %}
        {% for game in games %}
        <div class="game-card">
            <div class="card-header">
                <div class="card-title">
                    <h3 class="game-name"><a href="{{ url_for('game_name_stats', game_name=game['game_name']) }}">{{ game['game_name'] }}</a></h3>
                </div>
                <div class="game-date">
                    {{ game['game_date_only'] }}
                    {% if game['game_time'] %}<br>{{ game['game_time'] }}{% endif %}
                </div>
            </div>
            
            <div class="card-body">
                <div class="team-section winners">
                    <div class="team-content{% if game['winner_score'] is not none and game['winners'][0].score is none %} has-team-score{% endif %}">
                        <div class="players-list">
                            {% for winner in game['winners'] %}
                            <div class="player-item">
                                <a href="{{ url_for('other_player_stats', year=year, name=winner.name) }}">{{ winner.name }}</a>
                                {% if winner.score is not none and game['game_name'] != "Matterhorn" %}
                                <span class="player-score">{{ winner.score }}</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% if game['winner_score'] is not none and game['winners'][0].score is none %}
                        <div class="team-score-center"><span class="player-score">{{ game['winner_score'] }}</span></div>
                        {% endif %}
                    </div>
                </div>
                <div class="team-section losers">
                    <div class="team-content{% if game['loser_score'] is not none and game['losers'][0].score is none %} has-team-score{% endif %}">
                        <div class="players-list">
                            {% for loser in game['losers'] %}
                            <div class="player-item">
                                <a href="{{ url_for('other_player_stats', year=year, name=loser.name) }}">{{ loser.name }}</a>
                                {% if loser.score is not none and game['game_name'] != "Matterhorn" %}
                                <span class="player-score">{{ loser.score }}</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                        {% if game['loser_score'] is not none and game['losers'][0].score is none %}
                        <div class="team-score-center"><span class="player-score">{{ game['loser_score'] }}</span></div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <h2>No games yet</h2>
            <p>Games added in {{ year }} will appear here.</p>
        </div>
    {% endif %}
</div>

<script>
    function toggleStats() {
        const hiddenRows = document.querySelectorAll('.stats-hidden');
        const btn = document.getElementById('expand-stats');
        const isExpanded = btn.classList.contains('expanded');
        
        hiddenRows.forEach(row => {
            row.style.display = isExpanded ? 'none' : 'table-row';
        });
        
        if (isExpanded) {
            btn.innerHTML = 'Show {{ stats|length - 8 }} more <i class="fa fa-chevron-down"></i>';
            btn.classList.remove('expanded');
        } else {
            btn.innerHTML = 'Show less <i class="fa fa-chevron-down"></i>';
            btn.classList.add('expanded');
        }
    }
</script>
{% endblock %}
