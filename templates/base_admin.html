<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %} {% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="viewport" content="width=device-width" />
</head>
<body>
    {% if session.logged_in %}
    <nav>
        <div class="dropdown">
            <button class="dropbtn">Add/Edit
                <i class="fa fa-caret-down"></i>
            </button>
            <div class="dropdown-content">
                <a href="{{ url_for('add_game') }}">Doubles</a>
                <a href="{{ url_for('add_vollis_game') }}">Vollis</a>
                <a href="{{ url_for('add_other_game') }}">Other</a>
                <a href="{{ url_for('player_list') }}">Players</a>
            </div>
        </div>  
    </nav>
    {% endif %}
    
    <nav>
        <div class="menu-container">
            <button class="menu-toggle" id="menu-toggle">☰</button>
            <div class="menu-overlay" id="menu-overlay"></div>
            <div class="menu-sidebar" id="menu-sidebar">
                <button class="menu-close" id="menu-close">×</button>
                <ul class="menu-list">
                    <li><a href="{{ url_for('index') }}"><i class="fas fa-chart-bar"></i> Doubles Stats</a></li>
                    <li><a href="{{ url_for('vollis_stats_default') }}"><i class="fas fa-chart-line"></i> Vollis Stats</a></li>
                    <li><a href="{{ url_for('other_stats_default') }}"><i class="fas fa-chart-pie"></i> Other Stats</a></li>
                    {% if session.logged_in %}
                        <li><a href="{{ url_for('edit_stats') }}"><i class="fas fa-edit"></i> Edit Stats</a></li>
                        {% if session.username and session.username|lower == 'kyle' %}
                            <li><a href="{{ url_for('notifications') }}"><i class="fas fa-bell"></i> Notifications</a></li>
                            <li><a href="{{ url_for('benchmarks') }}"><i class="fas fa-tachometer-alt"></i> Benchmarks</a></li>
                        {% endif %}
                        <li><a href="{{ url_for('manage_player_names') }}"><i class="fas fa-edit"></i> Manage Player Names</a></li>
                        <li><a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout ({{ session.username }})</a></li>
                    {% else %}
                        <li><a href="{{ url_for('login') }}"><i class="fas fa-sign-in-alt"></i> Login</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- Notification Alert (only for Kyle) -->
    {% if session.logged_in and session.username and session.username|lower == 'kyle' %}
    <div id="notification-alert" class="notification-alert" style="display: none;" onclick="goToNotifications()">
        <div class="notification-content">
            <i class="fas fa-bell"></i>
            <span id="notification-text">You have unread notifications</span>
            <a href="{{ url_for('notifications') }}" class="notification-link">View Notifications</a>
            <button class="notification-dismiss" onclick="event.stopPropagation(); dismissNotificationAlert()">×</button>
        </div>
    </div>
    {% endif %}
    
    <div class="content">
        {% for message in get_flashed_messages() %}
            <div class="alert">{{ message }}</div>
        {% endfor %}
        {% block content %} {% endblock %}
    </div>

    <style>
        /* Notification Alert Styling */
        .notification-alert {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 12px 20px;
            margin: 0;
            border-bottom: 3px solid #d63031;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .notification-alert:hover {
            background: linear-gradient(135deg, #ff5252, #e53935);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        .notification-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
            gap: 15px;
        }
        
        .notification-content i {
            font-size: 18px;
            animation: pulse 2s infinite;
        }
        
        .notification-content span {
            font-weight: 600;
            font-size: 16px;
            flex-grow: 1;
        }
        
        .notification-link {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .notification-link:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-1px);
        }
        
        .notification-dismiss {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .notification-dismiss:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.1);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Clear button styling */
        .input-container {
            position: relative;
            display: inline-block;
            width: 100%;
            text-align: center;
        }

        .clear-btn {
            position: absolute;
            left: 6px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--caption);
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            padding: 0;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
            opacity: 0;
            visibility: hidden;
            z-index: 10;
        }

        .clear-btn:hover {
            background: var(--table-banding);
            color: var(--text);
        }

        .input-container:hover .clear-btn,
        .input-container input:focus + .clear-btn {
            opacity: 1;
            visibility: visible;
        }

        .input-container input {
            padding-left: 25px;
            text-align: center;
            width: 280px;
        }

        .input-container input::placeholder {
            text-align: center;
        }

        /* Ensure forms stay centered */
        form {
            text-align: center;
        }

        .input-container {
            text-align: center;
        }
    </style>

    <script>
        // Simple hamburger menu functionality
        const menuToggle = document.getElementById('menu-toggle');
        const menuClose = document.getElementById('menu-close');
        const menuOverlay = document.getElementById('menu-overlay');
        const menuSidebar = document.getElementById('menu-sidebar');

        function openMenu() {
            menuOverlay.classList.add('active');
            menuSidebar.classList.add('active');
            menuToggle.classList.add('active');
            menuToggle.textContent = '×';
        }

        function closeMenu() {
            menuOverlay.classList.remove('active');
            menuSidebar.classList.remove('active');
            menuToggle.classList.remove('active');
            menuToggle.textContent = '☰';
        }

        // Toggle menu when clicking hamburger button (opens if closed, closes if open)
        menuToggle.addEventListener('click', function() {
            if (menuToggle.classList.contains('active')) {
                closeMenu();
            } else {
                openMenu();
            }
        });

        // Close menu when clicking X button inside sidebar
        menuClose.addEventListener('click', closeMenu);

        // Close menu when clicking overlay (outside the sidebar)
        menuOverlay.addEventListener('click', closeMenu);

        // Close menu when clicking on menu links
        document.querySelectorAll('.menu-list a').forEach(link => {
            link.addEventListener('click', closeMenu);
        });

        // Clear button functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add clear buttons to all input fields
            const inputs = document.querySelectorAll('input[type="text"], input[type="number"]');
            
            inputs.forEach(input => {
                // Skip submit buttons
                if (input.type === 'submit') return;
                
                // Create container if it doesn't exist
                if (!input.parentElement.classList.contains('input-container')) {
                    const container = document.createElement('div');
                    container.className = 'input-container';
                    input.parentNode.insertBefore(container, input);
                    container.appendChild(input);
                }
                
                // Create clear button
                const clearBtn = document.createElement('button');
                clearBtn.type = 'button';
                clearBtn.className = 'clear-btn';
                clearBtn.innerHTML = '×';
                clearBtn.title = 'Clear field';
                
                // Add clear functionality
                clearBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    input.value = '';
                    input.focus();
                });
                
                // Insert clear button after input
                input.parentElement.appendChild(clearBtn);
                
                // Show/hide clear button based on input value
                function toggleClearButton() {
                    if (input.value.trim() !== '') {
                        clearBtn.style.opacity = '1';
                        clearBtn.style.visibility = 'visible';
                    } else {
                        clearBtn.style.opacity = '0';
                        clearBtn.style.visibility = 'hidden';
                    }
                }
                
                // Toggle on input and focus events
                input.addEventListener('input', toggleClearButton);
                input.addEventListener('focus', toggleClearButton);
                input.addEventListener('blur', function() {
                    setTimeout(toggleClearButton, 150);
                });
                
                // Initial check
                toggleClearButton();
            });
        });

        // Notification Alert Functionality
        function checkNotifications() {
            // Only check if user is Kyle
            if (document.getElementById('notification-alert')) {
                fetch('/api/notifications/count')
                    .then(response => response.json())
                    .then(data => {
                        const alert = document.getElementById('notification-alert');
                        const text = document.getElementById('notification-text');
                        
                        if (data.count > 0) {
                            text.textContent = `You have ${data.count} unread notification${data.count > 1 ? 's' : ''}`;
                            alert.style.display = 'block';
                        } else {
                            alert.style.display = 'none';
                        }
                    })
                    .catch(error => {
                        console.log('Could not check notifications:', error);
                    });
            }
        }
        
        function dismissNotificationAlert() {
            const alert = document.getElementById('notification-alert');
            if (alert) {
                alert.style.display = 'none';
            }
        }
        
        function goToNotifications() {
            window.location.href = "{{ url_for('notifications') }}";
        }
        
        // Check notifications on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkNotifications();
            
            // Detect and send user's timezone to server
            const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if (userTimezone) {
                fetch('/api/set_timezone', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({timezone: userTimezone})
                }).catch(err => console.log('Could not set timezone:', err));
            }
        });
        
        // Refresh notifications when returning from notifications page
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                checkNotifications();
            }
        });
        
        // Also check when the page becomes visible again
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                checkNotifications();
            }
        });

    </script>
</body>
</html>
