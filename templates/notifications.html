<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications – Stats</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stats.css') }}">
</head>
<body class="sr-page">
    <div class="menu-overlay" id="menu-overlay"></div>

    <div class="menu-sidebar" id="menu-sidebar">
        <button class="menu-close" id="menu-close">✕</button>
        <ul class="menu-list">
            <li><a href="{{ url_for('index') }}"><i class="fas fa-chart-bar"></i> Doubles</a></li>
            <li><a href="{{ url_for('vollis_stats_default') }}"><i class="fas fa-chart-line"></i> Vollis</a></li>
            <li><a href="{{ url_for('other_stats_default') }}"><i class="fas fa-chart-pie"></i> Other</a></li>
            {% if session.logged_in %}
            <li><a href="{{ url_for('edit_stats') }}"><i class="fas fa-edit"></i> Edit Stats</a></li>
            {% if session.username and session.username|lower == 'kyle' %}
            <li><a href="{{ url_for('add_game_voice') }}"><i class="fas fa-plus-circle"></i> Add Doubles (Voice)</a></li>
            <li><a href="{{ url_for('notifications') }}"><i class="fas fa-bell"></i> Notifications</a></li>
            <li><a href="{{ url_for('benchmarks') }}"><i class="fas fa-tachometer-alt"></i> Benchmarks</a></li>
            {% endif %}
            <li><a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            {% else %}
            <li><a href="{{ url_for('login') }}"><i class="fas fa-sign-in-alt"></i> Login</a></li>
            {% endif %}
        </ul>
    </div>

    <style>
        .menu-toggle { background: var(--sr-panel); border: 1px solid var(--sr-line); color: var(--sr-muted); border-radius: 8px; padding: 8px 12px; font-size: 14px; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; }
        .menu-toggle:hover { border-color: var(--sr-accent); color: var(--sr-accent); }
        .menu-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .menu-overlay.active { opacity: 1; visibility: visible; }
        .menu-sidebar { position: fixed; top: 0; right: -300px; width: 300px; height: 100%; background: #0f1620; z-index: 1000; transition: right 0.3s ease; padding: 20px; visibility: hidden; overflow-y: auto; }
        .menu-sidebar.active { right: 0; visibility: visible; }
        .menu-close { background: none; border: none; color: var(--sr-text); font-size: 20px; cursor: pointer; float: right; padding: 5px; margin-bottom: 20px; }
        .menu-list { list-style: none; padding: 0; margin: 0; clear: both; }
        .menu-list li { margin: 10px 0; }
        .menu-list a { display: block; padding: 12px 15px; color: var(--sr-text); text-decoration: none; border-radius: 8px; transition: all 0.2s; font-size: 14px; }
        .menu-list a:hover { background: var(--sr-accent-dim); color: var(--sr-accent); }
        .menu-list a i { margin-right: 10px; width: 16px; }

        .sr-notification-card {
            background: var(--sr-panel);
            border: 1px solid var(--sr-line);
            border-radius: 10px;
            padding: 14px 16px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        .sr-notification-card:hover { border-color: rgba(255, 255, 255, 0.12); }
        .sr-notification-card.sr-notification-read { opacity: 0.7; border-color: var(--sr-line); }
        .sr-notification-card.sr-notification-read .sr-notification-user { color: var(--sr-muted); }
        .sr-notification-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .sr-notification-checkbox { width: 18px; height: 18px; cursor: pointer; accent-color: var(--sr-accent); flex-shrink: 0; }
        .sr-notification-user { font-weight: 600; color: var(--sr-accent); font-size: 14px; }
        .sr-notification-action { font-size: 13px; color: var(--sr-text); }
        .sr-notification-details { font-size: 12px; color: var(--sr-muted); margin-left: 30px; margin-top: 4px; }
        .sr-notification-time { font-size: 11px; color: var(--sr-muted); margin-left: 30px; margin-top: 2px; }
        .sr-notification-actions { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px; margin-bottom: 16px; }
        .sr-notification-empty { text-align: center; padding: 48px 24px; color: var(--sr-muted); }
        .sr-notification-empty h3 { font-size: 18px; margin: 0 0 8px; color: var(--sr-text); }
        .sr-mark-read-btn {
            background: var(--sr-accent-dim);
            border: 1px solid var(--sr-accent);
            color: var(--sr-accent);
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .sr-mark-read-btn:hover { background: rgba(110, 231, 255, 0.25); }
        .sr-mark-read-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .sr-alert { padding: 12px 16px; border-radius: 8px; background: var(--sr-accent-dim); border: 1px solid var(--sr-accent); color: var(--sr-text); font-size: 14px; }
    </style>

    <div class="sr-container">
        <header class="sr-header sr-header-compact">
            <h1 class="sr-title">User Activity Notifications</h1>
            <div class="sr-header-actions">
                <button class="menu-toggle" id="menu-toggle"><i class="fas fa-bars"></i> Menu</button>
            </div>
        </header>

        {% for message in get_flashed_messages() %}
        <div class="sr-alert" style="margin-bottom: 16px;">{{ message }}</div>
        {% endfor %}

        {% if notifications %}
        <form method="POST" action="{{ url_for('mark_notifications_read_route') }}">
            {% if unread_count > 0 %}
            <div class="sr-notification-actions">
                <label class="sr-section-label" style="margin: 0; display: inline-flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="select-all" onchange="toggleAllCheckboxes()" style="width: 18px; height: 18px; accent-color: var(--sr-accent);">
                    Select all ({{ unread_count }} unread)
                </label>
                <button type="submit" class="sr-mark-read-btn" id="mark-read-btn" onclick="return confirm('Mark selected as read?')">
                    <i class="fas fa-check"></i> Mark selected as read
                </button>
            </div>
            {% else %}
            <p style="color: var(--sr-muted); font-size: 14px; margin-bottom: 12px;">Showing all {{ notifications|length }} notification(s). All caught up.</p>
            {% endif %}
            <div class="sr-card sr-card-compact">
                {% for notification in notifications %}
                <div class="sr-notification-card{% if notification[5] %} sr-notification-read{% endif %}">
                    <div class="sr-notification-header">
                        {% if not notification[5] %}
                        <input type="checkbox" name="notification_ids" value="{{ notification[0] }}" class="sr-notification-checkbox notification-checkbox" id="n{{ notification[0] }}">
                        {% else %}
                        <span class="sr-notification-checkbox-placeholder" style="width: 18px; flex-shrink: 0; display: inline-block;"></span>
                        {% endif %}
                        <span class="sr-notification-user">{{ notification[1] }}</span>
                        <span class="sr-notification-action">{{ notification[2] }}{% if notification[5] %} <span style="color: var(--sr-muted); font-size: 11px;">(read)</span>{% endif %}</span>
                    </div>
                    <div class="sr-notification-details">{{ notification[3] or '—' }}</div>
                    <div class="sr-notification-time">{{ notification[4] }}</div>
                </div>
                {% endfor %}
            </div>
        </form>
        {% else %}
        <div class="sr-card sr-card-compact">
            <div class="sr-notification-empty">
                <h3>No notifications yet</h3>
                <p>Activity from other users will appear here.</p>
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        (function() {
            var menuToggle = document.getElementById('menu-toggle');
            var menuOverlay = document.getElementById('menu-overlay');
            var menuSidebar = document.getElementById('menu-sidebar');
            var menuClose = document.getElementById('menu-close');
            function openMenu() { menuOverlay.classList.add('active'); menuSidebar.classList.add('active'); }
            function closeMenu() { menuOverlay.classList.remove('active'); menuSidebar.classList.remove('active'); }
            if (menuToggle) menuToggle.addEventListener('click', openMenu);
            if (menuOverlay) menuOverlay.addEventListener('click', closeMenu);
            if (menuClose) menuClose.addEventListener('click', closeMenu);
        })();

        function toggleAllCheckboxes() {
            var selectAll = document.getElementById('select-all');
            var checkboxes = document.querySelectorAll('.notification-checkbox');
            if (selectAll && checkboxes.length) {
                checkboxes.forEach(function(cb) { cb.checked = selectAll.checked; });
            }
        }
        document.querySelectorAll('.notification-checkbox').forEach(function(checkbox) {
            checkbox.addEventListener('change', function() {
                var all = document.querySelectorAll('.notification-checkbox');
                var checked = document.querySelectorAll('.notification-checkbox:checked');
                var selectAll = document.getElementById('select-all');
                if (selectAll && all.length) {
                    selectAll.checked = checked.length === all.length;
                    selectAll.indeterminate = checked.length > 0 && checked.length < all.length;
                }
            });
        });
    </script>
</body>
</html>
