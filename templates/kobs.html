{% extends 'base.html' %}

{% block content %}
    <h1>{% block title %} Volleyball KOBs {% endblock %}</h1>
    
    {% if kobs_with_games %}
        <div class="search-container">
            <input type="text" id="kobSearch" placeholder="Search by player names (e.g., kyle chow goshow)..." onkeyup="searchKOBs()">
            <p id="resultCount">Showing {{ kobs_with_games|length }} KOBs</p>
        </div>
        
        <div>
            <table class="kobs-table">
                <thead>
                    <tr>
                        <th scope="col">Date</th>
                        <th scope="col">Players</th>
                        <th scope="col">Games</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                {% for kob_data in kobs_with_games %}
                {% set kob = kob_data.kob %}
                {% set games = kob_data.games %}
                {% set players = kob_data.players %}
                    <tr>
                        <td class="kob-date">{% if kob[1] %}{{ kob[1][5:7] }}/{{ kob[1][8:10] }}/{{ kob[1][2:4] }}{% else %}Unknown{% endif %}</td>
                        <td class="kob-players">
                            <div class="player-name-line">{{ players[0] }}</div>
                            <div class="player-name-line">{{ players[1] }}</div>
                            <div class="player-name-line">{{ players[2] }}</div>
                            <div class="player-name-line">{{ players[3] }}</div>
                        </td>
                        <td class="kob-games">{{ kob[3] }}</td>
                        <td class="kob-link"><a href="{{ url_for('kob_detail', session_number=kob[0]) }}">View Details</a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p>No KOBs found in the database.</p>
    {% endif %}
    
<style>
.search-container {
    text-align: center;
    margin: 20px auto;
    max-width: 600px;
}

#kobSearch {
    width: 100%;
    padding: 12px 16px;
    font-size: 15px;
    border: 2px solid var(--button-bg-1);
    border-radius: 8px;
    background-color: var(--bg);
    color: var(--text);
    transition: border-color 0.2s ease;
}

#kobSearch:focus {
    outline: none;
    border-color: var(--button-bg-1);
    box-shadow: 0 0 0 3px rgba(174, 238, 152, 0.1);
}

#kobSearch::placeholder {
    color: var(--caption);
}

#resultCount {
    text-align: center;
    color: var(--caption);
    font-size: 14px;
    margin: 10px 0 20px 0;
}

.kobs-table tbody tr {
    height: auto;
}

.kobs-table .kob-date {
    white-space: nowrap;
    font-weight: 500;
    color: var(--button-bg-1);
}

.kobs-table .kob-players {
    padding: 15px 10px !important;
    line-height: 1.6;
}

.player-name-line {
    white-space: nowrap;
}

.kobs-table .kob-games {
    text-align: center;
    font-weight: 600;
    color: var(--button-bg-1);
    font-size: 16px;
}

.kobs-table .kob-link {
    text-align: right;
    padding-right: 15px !important;
}

.kobs-table .kob-link a {
    color: var(--button-bg-1);
    text-decoration: none;
    font-weight: 500;
    padding: 6px 12px;
    border-radius: 4px;
    transition: background-color 0.2s ease;
    display: inline-block;
}

.kobs-table .kob-link a:hover {
    background-color: rgba(174, 238, 152, 0.1);
    text-decoration: none;
}
</style>

<script>
function searchKOBs() {
    const input = document.getElementById('kobSearch');
    const filter = input.value.toLowerCase().trim();
    const table = document.querySelector('.kobs-table tbody');
    const rows = table.getElementsByTagName('tr');
    const resultCount = document.getElementById('resultCount');
    
    let visibleCount = 0;
    
    // Split the search terms by spaces
    const searchTerms = filter.split(/\s+/).filter(term => term.length > 0);
    
    for (let i = 0; i < rows.length; i++) {
        const row = rows[i];
        const playersCell = row.querySelector('.kob-players');
        
        if (playersCell) {
            const playersText = playersCell.textContent.toLowerCase();
            
            // Check if ALL search terms are present in the players text
            const allTermsMatch = searchTerms.every(term => playersText.includes(term));
            
            if (searchTerms.length === 0 || allTermsMatch) {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        }
    }
    
    resultCount.textContent = `Showing ${visibleCount} of {{ kobs_with_games|length }} KOBs`;
}
</script>
{% endblock %}
